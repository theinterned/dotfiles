"use strict";var V=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var ie=(e,t)=>{for(var o in t)V(e,o,{get:t[o],enumerable:!0})},se=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of re(t))!ne.call(e,a)&&a!==o&&V(e,a,{get:()=>t[a],enumerable:!(n=oe(t,a))||n.enumerable});return e};var ae=e=>se(V({},"__esModule",{value:!0}),e);var ce={};ie(ce,{default:()=>te});module.exports=ae(ce);var s=require("@raycast/api"),ee=require("react");var Q=require("@raycast/api"),I=require("react");var h=require("@raycast/api"),E=require("child_process"),B=require("crypto"),l=require("fs"),W=require("path");var F=e=>{let t=Math.floor(e/3600),o=String(Math.floor(e%3600/60)).padStart(2,"0"),n=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${o}:${n}`};var L=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var C=h.environment.supportPath+"/customTimers.json";async function v(e,t="Untitled",o="default"){let a=(h.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,l.writeFileSync)(a,t);let u=(0,h.getPreferenceValues)(),p=`${h.environment.assetsPath+"/"+(o==="default"?u.selectedSound:o)}`,S=[`sleep ${e}`];S.push(`if [ -f "${a}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let w=`afplay "${p}" --volume ${u.volumeSetting.replace(",",".")}`;if(u.selectedSound==="speak_timer_name"?S.push(`say "${t}"`):S.push(w),u.ringContinuously){let i=`${a}`.replace(".timer",".dismiss");(0,l.writeFileSync)(i,".dismiss file for Timers"),S.push(`while [ -f "${i}" ]; do ${w}; done`)}S.push(`rm "${a}"; else echo "Timer deleted"; fi`),(0,E.exec)(S.join(" && "),(i,N)=>{if(i){console.log(`error: ${i.message}`);return}if(N){console.log(`stderr: ${N}`);return}}),(0,h.popToRoot)(),await(0,h.showHUD)(`Timer "${t}" started for ${F(e)}! \u{1F389}`)}function j(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,o=e.replace(".timer",".dismiss"),n=`if [ -f "${o}" ]; then rm "${o}"; else echo "Timer deleted"; fi`;(0,E.execSync)(t),(0,E.execSync)(n)}function Y(){let e=[];return(0,l.readdirSync)(h.environment.supportPath).forEach(o=>{if((0,W.extname)(o)==".timer"){let n={name:"",secondsSet:-99,timeLeft:-99,originalFile:o};n.name=(0,l.readFileSync)(h.environment.supportPath+"/"+o).toString();let a=o.split("---");n.secondsSet=Number(a[1].split(".")[0]);let u=a[0].replace(/__/g,":");n.timeLeft=Math.max(0,Math.round(n.secondsSet-L({d2:u}))),e.push(n)}}),e.sort((o,n)=>o.timeLeft-n.timeLeft),e}function q(e,t){let o=h.environment.supportPath+"/"+e;(0,l.writeFileSync)(o,t)}function D(){(0,l.existsSync)(C)||(0,l.writeFileSync)(C,JSON.stringify({}))}function O(e){D();let t=JSON.parse((0,l.readFileSync)(C,"utf8"));t[(0,B.randomUUID)()]=e,(0,l.writeFileSync)(C,JSON.stringify(t))}function z(){return D(),JSON.parse((0,l.readFileSync)(C,"utf8"))}function G(e,t){D();let o=JSON.parse((0,l.readFileSync)(C,"utf8"));o[e].name=t,(0,l.writeFileSync)(C,JSON.stringify(o))}function K(e){D();let t=JSON.parse((0,l.readFileSync)(C,"utf8"));delete t[e],(0,l.writeFileSync)(C,JSON.stringify(t))}function U(){let[e,t]=(0,I.useState)(void 0),[o,n]=(0,I.useState)({}),[a,u]=(0,I.useState)(e===void 0),p=()=>{D();let d=Y();t(d);let y=z();n(y),u(!1)};return{timers:e,customTimers:o,isLoading:a,refreshTimers:p,handleStartTimer:(d,y)=>{v(d,y),p()},handleStopTimer:d=>{t(e?.filter(y=>y.originalFile!==d.originalFile)),j(`${Q.environment.supportPath}/${d.originalFile}`),p()},handleStartCT:d=>{v(d.timeInSeconds,d.name,d.selectedSound),p()},handleCreateCT:d=>{let y={name:d.name,timeInSeconds:d.secondsSet,selectedSound:"default"};O(y),p()},handleDeleteCT:d=>{K(d),p()}}}var f=require("@raycast/api");var A=require("@raycast/api");var b=require("fs");var $=A.environment.supportPath+"/raycast-stopwatches.json",me=()=>{(0,b.existsSync)($)||(0,b.writeFileSync)($,JSON.stringify([]))};var X=(e,t)=>{me();let n=JSON.parse((0,b.readFileSync)($,"utf8")).map(a=>a.swID==e?{...a,name:t}:a);(0,b.writeFileSync)($,JSON.stringify(n))};var k=require("react/jsx-runtime");function J(e){let t=o=>{if(o===""||o===e.currentName)new f.Toast({style:f.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,f.popToRoot)(),e.originalFile){case"customTimer":G(e.ctID?e.ctID:"-99",o);break;case"stopwatch":X(e.ctID?e.ctID:"-99",o);break;default:q(e.originalFile,o);break}new f.Toast({style:f.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,k.jsx)(f.Form,{actions:(0,k.jsx)(f.ActionPanel,{children:(0,k.jsx)(f.Action.SubmitForm,{title:"Rename",onSubmit:o=>t(o.newName)})}),children:(0,k.jsx)(f.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var c=require("@raycast/api"),M=require("react");var P=require("@raycast/api"),Z=[{title:"Alarm Clock",icon:P.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:P.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:P.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:P.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:P.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:P.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:P.Icon.Person,value:"speak_timer_name"}];var g=require("react/jsx-runtime");function H(e){let t=Object.values(e.arguments).some(r=>r!==""),[o,n]=(0,M.useState)(),[a,u]=(0,M.useState)(),[p,S]=(0,M.useState)(),w=r=>{if(D(),r.hours===""&&r.minutes===""&&r.seconds==="")new c.Toast({style:c.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(r.hours)))n("Hours must be a number!");else if(isNaN(Number(r.minutes)))u("Minutes must be a number!");else if(isNaN(Number(r.seconds)))S("Seconds must be a number!");else{(0,c.closeMainWindow)();let T=r.name?r.name:"Untitled",_=3600*Number(r.hours)+60*Number(r.minutes)+Number(r.seconds);v(_,T,r.selectedSound),r.willBeSaved&&O({name:r.name,timeInSeconds:_,selectedSound:r.selectedSound})}},i=()=>{o&&o.length>0&&n(void 0)},N=()=>{a&&a.length>0&&u(void 0)},R=()=>{p&&p.length>0&&S(void 0)},x=[{id:"hours",title:"Hours",placeholder:"0",err:o,drop:i,validator:r=>{let T=r.target.value;isNaN(Number(T))?n("Hours must be a number!"):i()}},{id:"minutes",title:"Minutes",placeholder:"00",err:a,drop:N,validator:r=>{let T=r.target.value;isNaN(Number(T))?u("Minutes must be a number!"):N()}},{id:"seconds",title:"Seconds",placeholder:"00",err:p,drop:R,validator:r=>{let T=r.target.value;isNaN(Number(T))?S("Seconds must be a number!"):R()}}];return(0,c.getPreferenceValues)().newTimerInputOrder!=="hhmmss"&&x.reverse(),(0,g.jsxs)(c.Form,{actions:(0,g.jsx)(c.ActionPanel,{children:(0,g.jsx)(c.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:r=>w(r)})}),children:[x.map((r,T)=>(0,g.jsx)(c.Form.TextField,{id:r.id,title:r.title,placeholder:r.placeholder,defaultValue:e.arguments[r.id],error:r.err,onChange:r.drop,onBlur:r.validator},T)),(0,g.jsxs)(c.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,g.jsx)(c.Form.Dropdown.Item,{value:"default",title:"Default"}),Z.map((r,T)=>(0,g.jsx)(c.Form.Dropdown.Item,{title:r.title,value:r.value,icon:r.icon},T))]}),(0,g.jsx)(c.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,g.jsx)(c.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var m=require("react/jsx-runtime");function te(){let{timers:e,customTimers:t,isLoading:o,refreshTimers:n,handleStopTimer:a,handleStartCT:u,handleCreateCT:p,handleDeleteCT:S}=U(),{push:w}=(0,s.useNavigation)();return(0,ee.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]),(0,m.jsxs)(s.List,{isLoading:o,children:[(0,m.jsxs)(s.List.Section,{title:e?.length!==0&&e!=null?"Currently Running":"No Timers Running",children:[e?.map(i=>(0,m.jsx)(s.List.Item,{icon:{source:s.Icon.Clock,tintColor:s.Color.Yellow},title:i.name,subtitle:F(i.timeLeft)+" left",accessories:[{text:F(i.secondsSet)+" originally"}],actions:(0,m.jsxs)(s.ActionPanel,{children:[(0,m.jsx)(s.Action,{title:"Stop Timer",onAction:()=>a(i)}),(0,m.jsx)(s.Action,{title:"Rename Timer",onAction:()=>w((0,m.jsx)(J,{currentName:i.name,originalFile:i.originalFile,ctID:null}))}),(0,m.jsx)(s.Action,{title:"Save Timer as Preset",shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>p(i)})]})},i.originalFile)),(0,m.jsx)(s.List.Item,{icon:s.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,m.jsx)(s.ActionPanel,{children:(0,m.jsx)(s.Action,{title:"Start Timer",onAction:()=>w((0,m.jsx)(H,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,m.jsx)(s.List.Section,{title:"Custom Timers",children:Object.keys(t)?.sort((i,N)=>t[i].timeInSeconds-t[N].timeInSeconds).map(i=>(0,m.jsx)(s.List.Item,{icon:s.Icon.Clock,title:t[i].name,subtitle:F(t[i].timeInSeconds),actions:(0,m.jsxs)(s.ActionPanel,{children:[(0,m.jsx)(s.Action,{title:"Start Timer",onAction:()=>u(t[i])}),(0,m.jsx)(s.Action,{title:"Rename Timer",onAction:()=>w((0,m.jsx)(J,{currentName:t[i].name,originalFile:"customTimer",ctID:i}))}),(0,m.jsx)(s.Action,{title:"Delete Custom Timer",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>S(i)})]})},i))})]})}0&&(module.exports={});
