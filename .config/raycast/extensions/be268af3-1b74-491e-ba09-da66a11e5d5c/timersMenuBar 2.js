"use strict";var $=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},U=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of b(t))!_.call(e,i)&&i!==n&&$(e,i,{get:()=>t[i],enumerable:!(o=E(t,i))||o.enumerable});return e};var j=e=>U($({},"__esModule",{value:!0}),e);var H={};B(H,{default:()=>v});module.exports=j(H);var r=require("@raycast/api"),J=require("react");var F=require("@raycast/api"),M=require("react");var c=require("@raycast/api"),g=require("child_process"),P=require("crypto"),u=require("fs"),w=require("path");var h=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),o=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${n}:${o}`};var k=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var T=c.environment.supportPath+"/customTimers.json";async function D(e,t="Untitled",n="default"){let i=(c.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,u.writeFileSync)(i,t);let d=(0,c.getPreferenceValues)(),l=`${c.environment.assetsPath+"/"+(n==="default"?d.selectedSound:n)}`,s=[`sleep ${e}`];s.push(`if [ -f "${i}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let S=`afplay "${l}" --volume ${d.volumeSetting.replace(",",".")}`;if(d.selectedSound==="speak_timer_name"?s.push(`say "${t}"`):s.push(S),d.ringContinuously){let p=`${i}`.replace(".timer",".dismiss");(0,u.writeFileSync)(p,".dismiss file for Timers"),s.push(`while [ -f "${p}" ]; do ${S}; done`)}s.push(`rm "${i}"; else echo "Timer deleted"; fi`),(0,g.exec)(s.join(" && "),(p,y)=>{if(p){console.log(`error: ${p.message}`);return}if(y){console.log(`stderr: ${y}`);return}}),(0,c.popToRoot)(),await(0,c.showHUD)(`Timer "${t}" started for ${h(e)}! \u{1F389}`)}function A(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,n=e.replace(".timer",".dismiss"),o=`if [ -f "${n}" ]; then rm "${n}"; else echo "Timer deleted"; fi`;(0,g.execSync)(t),(0,g.execSync)(o)}function x(){let e=[];return(0,u.readdirSync)(c.environment.supportPath).forEach(n=>{if((0,w.extname)(n)==".timer"){let o={name:"",secondsSet:-99,timeLeft:-99,originalFile:n};o.name=(0,u.readFileSync)(c.environment.supportPath+"/"+n).toString();let i=n.split("---");o.secondsSet=Number(i[1].split(".")[0]);let d=i[0].replace(/__/g,":");o.timeLeft=Math.max(0,Math.round(o.secondsSet-k({d2:d}))),e.push(o)}}),e.sort((n,o)=>n.timeLeft-o.timeLeft),e}function C(){(0,u.existsSync)(T)||(0,u.writeFileSync)(T,JSON.stringify({}))}function O(e){C();let t=JSON.parse((0,u.readFileSync)(T,"utf8"));t[(0,P.randomUUID)()]=e,(0,u.writeFileSync)(T,JSON.stringify(t))}function L(){return C(),JSON.parse((0,u.readFileSync)(T,"utf8"))}function N(e){C();let t=JSON.parse((0,u.readFileSync)(T,"utf8"));delete t[e],(0,u.writeFileSync)(T,JSON.stringify(t))}function I(){let[e,t]=(0,M.useState)(void 0),[n,o]=(0,M.useState)({}),[i,d]=(0,M.useState)(e===void 0),l=()=>{C();let a=x();t(a);let f=L();o(f),d(!1)};return{timers:e,customTimers:n,isLoading:i,refreshTimers:l,handleStartTimer:(a,f)=>{D(a,f),l()},handleStopTimer:a=>{t(e?.filter(f=>f.originalFile!==a.originalFile)),A(`${F.environment.supportPath}/${a.originalFile}`),l()},handleStartCT:a=>{D(a.timeInSeconds,a.name,a.selectedSound),l()},handleCreateCT:a=>{let f={name:a.name,timeInSeconds:a.secondsSet,selectedSound:"default"};O(f),l()},handleDeleteCT:a=>{N(a),l()}}}var m=require("react/jsx-runtime");function v(){let{timers:e,customTimers:t,isLoading:n,refreshTimers:o,handleStartTimer:i,handleStopTimer:d,handleStartCT:l}=I();return(0,J.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]),(0,m.jsxs)(r.MenuBarExtra,{icon:r.Icon.Clock,isLoading:n,title:e!=null&&e?.length>0?`${e[0].name}: ~${h(e[0].timeLeft)}`:void 0,children:[(0,m.jsx)(r.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(s=>(0,m.jsx)(r.MenuBarExtra.Item,{title:s.name+": "+h(s.timeLeft)+" left",onAction:()=>d(s)},s.originalFile)),(0,m.jsx)(r.MenuBarExtra.Separator,{}),Object.keys(t)?.sort((s,S)=>t[s].timeInSeconds-t[S].timeInSeconds).map(s=>(0,m.jsx)(r.MenuBarExtra.Item,{title:'Start "'+t[s].name+'"',onAction:()=>l(t[s])},s)),(0,m.jsx)(r.MenuBarExtra.Separator,{}),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>i(60*2,"2 Minute Timer")},"2M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>i(60*5,"5 Minute Timer")},"5M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>i(60*10,"10 Minute Timer")},"10M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>i(60*15,"15 Minute Timer")},"15M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>i(60*30,"30 Minute Timer")},"30M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>i(60*45,"45 Minute Timer")},"45M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>i(60*60,"60 Minute Timer")},"60M"),(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>i(60*60*1.5,"90 Minute Timer")},"90M"),(0,m.jsx)(r.MenuBarExtra.Section,{title:"Custom Timer",children:(0,m.jsx)(r.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,r.launchCommand)({name:"startCustomTimer",type:r.LaunchType.UserInitiated})},"custom")})]})}0&&(module.exports={});
