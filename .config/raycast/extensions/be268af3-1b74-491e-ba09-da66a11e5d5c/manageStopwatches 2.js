"use strict";var $=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var z=(t,e)=>{for(var o in e)$(t,o,{get:e[o],enumerable:!0})},K=(t,e,o,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Y(e))!q.call(t,n)&&n!==o&&$(t,n,{get:()=>e[n],enumerable:!(a=G(e,n))||a.enumerable});return t};var Q=t=>K($({},"__esModule",{value:!0}),t);var et={};z(et,{default:()=>j});module.exports=Q(et);var s=require("@raycast/api"),V=require("react");var y=require("@raycast/api"),N=require("react");var S=t=>{let e=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),a=String(Math.floor(t%60)).padStart(2,"0");return`${e}:${o}:${a}`},A=t=>{let e=new Date(t),o=[e.getFullYear().toString(),e.getMonth().toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],a=[e.getHours(),e.getMinutes(),e.getSeconds()].map(T=>T.toString().padStart(2,"0")),n=o.join("-"),g=a.join(":");return`${n} ${g}`},f=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var u=require("@raycast/api"),W=require("child_process"),b=require("crypto"),r=require("fs"),R=require("path");var i=u.environment.supportPath+"/raycast-stopwatches.json",h=()=>{(0,r.existsSync)(i)||(0,r.writeFileSync)(i,JSON.stringify([]))},U=(t="")=>({name:t,swID:(0,b.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),X=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,f({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let o=Math.max(0,f({d2:e.timeStarted}));e.timeElapsed=o-e.pauseElapsed}}),t),F=()=>{h();let t=JSON.parse((0,r.readFileSync)(i).toString()),e=Z(t),o=X(e);return o.sort((a,n)=>a.timeElapsed-n.timeElapsed),o},k=async(t="Untitled")=>{h();let e=JSON.parse((0,r.readFileSync)(i).toString()),o=U(t);e.push(o),(0,r.writeFileSync)(i,JSON.stringify(e)),(0,u.popToRoot)(),await(0,u.showHUD)(`Stopwatch "${t}" started! \u{1F389}`)},v=t=>{h();let e=JSON.parse((0,r.readFileSync)(i).toString());e=e.map(o=>o.swID==t?{...o,lastPaused:new Date}:o),(0,r.writeFileSync)(i,JSON.stringify(e))},x=t=>{h();let e=JSON.parse((0,r.readFileSync)(i).toString());e=e.map(o=>o.swID==t?{...o,pauseElapsed:o.pauseElapsed+f({d2:o.lastPaused}),lastPaused:"----"}:o),(0,r.writeFileSync)(i,JSON.stringify(e))},L=t=>{h();let e=JSON.parse((0,r.readFileSync)(i).toString());e=e.filter(o=>o.swID!==t),(0,r.writeFileSync)(i,JSON.stringify(e))},Z=t=>((0,r.readdirSync)(u.environment.supportPath).forEach(o=>{if((0,R.extname)(o)==".stopwatch"){let a=U((0,r.readFileSync)(u.environment.supportPath+"/"+o).toString()),n=o.replace(/__/g,":").replace(".stopwatch","");a.timeStarted=new Date(n),a.timeElapsed=Math.max(0,f({})),(0,W.execSync)(`rm "${u.environment.supportPath}/${o}"`),t.push(a)}}),(0,r.writeFileSync)(i,JSON.stringify(t)),t),M=(t,e)=>{h();let a=JSON.parse((0,r.readFileSync)(i,"utf8")).map(n=>n.swID==t?{...n,name:e}:n);(0,r.writeFileSync)(i,JSON.stringify(a))};function O(){let[t,e]=(0,N.useState)(void 0),[o,a]=(0,N.useState)(t===void 0),n=()=>{let l=F();e(l),a(!1)};return{stopwatches:t,isLoading:o,refreshSWes:n,handleStartSW:()=>{k(),n()},handleStopSW:l=>{(0,y.getPreferenceValues)().copyOnSwStop&&y.Clipboard.copy(S(l.timeElapsed)),L(l.swID),n()},handlePauseSW:l=>{v(l),n()},handleUnpauseSW:l=>{x(l),n()}}}var c=require("@raycast/api");var w=require("@raycast/api");var d=require("fs");var D=w.environment.supportPath+"/customTimers.json";function _(t,e){let o=w.environment.supportPath+"/"+t;(0,d.writeFileSync)(o,e)}function tt(){(0,d.existsSync)(D)||(0,d.writeFileSync)(D,JSON.stringify({}))}function H(t,e){tt();let o=JSON.parse((0,d.readFileSync)(D,"utf8"));o[t].name=e,(0,d.writeFileSync)(D,JSON.stringify(o))}var P=require("react/jsx-runtime");function C(t){let e=o=>{if(o===""||o===t.currentName)new c.Toast({style:c.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,c.popToRoot)(),t.originalFile){case"customTimer":H(t.ctID?t.ctID:"-99",o);break;case"stopwatch":M(t.ctID?t.ctID:"-99",o);break;default:_(t.originalFile,o);break}new c.Toast({style:c.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,P.jsx)(c.Form,{actions:(0,P.jsx)(c.ActionPanel,{children:(0,P.jsx)(c.Action.SubmitForm,{title:"Rename",onSubmit:o=>e(o.newName)})}),children:(0,P.jsx)(c.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var m=require("react/jsx-runtime");function j(){let{stopwatches:t,isLoading:e,refreshSWes:o,handleStartSW:a,handleStopSW:n,handlePauseSW:g,handleUnpauseSW:T}=O(),{push:I}=(0,s.useNavigation)();(0,V.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]);let E={tag:{value:"Paused",color:s.Color.Red}},l={tag:{value:"Running",color:s.Color.Green}},J={source:s.Icon.Clock,tintColor:s.Color.Red},B={source:s.Icon.Clock,tintColor:s.Color.Green};return(0,m.jsx)(s.List,{isLoading:e,children:(0,m.jsxs)(s.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(p=>(0,m.jsx)(s.List.Item,{icon:p.lastPaused=="----"?B:J,title:p.name,subtitle:S(p.timeElapsed)+" elapsed",accessories:[{text:"Started at "+A(p.timeStarted)},p.lastPaused=="----"?l:E],actions:(0,m.jsxs)(s.ActionPanel,{children:[p.lastPaused=="----"?(0,m.jsx)(s.Action,{title:"Pause Stopwatch",onAction:()=>g(p.swID)}):(0,m.jsx)(s.Action,{title:"Unpause Stopwatch",onAction:()=>T(p.swID)}),(0,m.jsx)(s.Action,{title:"Rename Stopwatch",onAction:()=>I((0,m.jsx)(C,{currentName:p.name,originalFile:"stopwatch",ctID:p.swID}))}),(0,m.jsx)(s.Action,{title:"Copy Current Time",shortcut:{modifiers:["opt"],key:"c"},onAction:()=>s.Clipboard.copy(S(p.timeElapsed))}),(0,m.jsx)(s.Action,{title:"Stop Stopwatch",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>n(p)})]})},p.swID)),(0,m.jsx)(s.List.Item,{icon:s.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,m.jsx)(s.ActionPanel,{children:(0,m.jsx)(s.Action,{title:"Start Stopwatch",onAction:()=>a()})})},0)]})})}0&&(module.exports={});
