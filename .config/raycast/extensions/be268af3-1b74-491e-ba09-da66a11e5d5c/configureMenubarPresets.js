"use strict";var w=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var K=(e,t)=>{for(var s in t)w(e,s,{get:t[s],enumerable:!0})},Q=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of G(t))!z.call(e,r)&&r!==s&&w(e,r,{get:()=>t[r],enumerable:!(i=q(t,r))||i.enumerable});return e};var W=e=>Q(w({},"__esModule",{value:!0}),e);var X={};K(X,{default:()=>U});module.exports=W(X);var P=require("react");var o=require("@raycast/api"),C=require("child_process"),F=require("crypto"),n=require("fs"),N=require("path");var D=e=>{let t=Math.floor(e/3600),s=String(Math.floor(e%3600/60)).padStart(2,"0"),i=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${s}:${i}`};var I=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var p=o.environment.supportPath+"/customTimers.json",b=o.environment.supportPath+"/defaultPresetVisibles.json",V=(e=!1)=>{let t=(0,o.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let s="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,o.showHUD)(s):(0,o.showToast)({style:o.Toast.Style.Failure,title:s}),!1}return!0};async function O(e,t="Untitled",s="default"){(0,o.popToRoot)();let r=(o.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,n.writeFileSync)(r,t);let m=(0,o.getPreferenceValues)(),c=`${o.environment.assetsPath+"/"+(s==="default"?m.selectedSound:s)}`,d=[`sleep ${e}`];d.push(`if [ -f "${r}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let M=`afplay "${c}" --volume ${m.volumeSetting.replace(",",".")}`;if(m.selectedSound==="speak_timer_name"?d.push(`say "${t}"`):d.push(M),m.ringContinuously){let g=`${r}`.replace(".timer",".dismiss");(0,n.writeFileSync)(g,".dismiss file for Timers"),d.push(`while [ -f "${g}" ]; do ${M}; done`)}d.push(`rm "${r}"; else echo "Timer deleted"; fi`),(0,C.exec)(d.join(" && "),(g,S)=>{if(g){console.log(`error: ${g.message}`);return}if(S){console.log(`stderr: ${S}`);return}}),await(0,o.showHUD)(`Timer "${t}" started for ${D(e)}! \u{1F389}`)}function v(e){let t=o.environment.supportPath+"/"+e,s=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,i=t.replace(".timer",".dismiss"),r=`if [ -f "${i}" ]; then rm "${i}"; else echo "Timer deleted"; fi`;(0,C.execSync)(s),(0,C.execSync)(r)}function B(){let e=[];return(0,n.readdirSync)(o.environment.supportPath).forEach(s=>{if((0,N.extname)(s)==".timer"){let i={name:"",secondsSet:-99,timeLeft:-99,originalFile:s,timeEnds:new Date};i.name=(0,n.readFileSync)(o.environment.supportPath+"/"+s).toString();let r=s.split("---");i.secondsSet=Number(r[1].split(".")[0]);let m=r[0].replace(/__/g,":");i.timeLeft=Math.max(0,Math.round(i.secondsSet-I({d2:m}))),i.timeEnds=new Date(m),i.timeEnds.setSeconds(i.timeEnds.getSeconds()+i.secondsSet),e.push(i)}}),e.sort((s,i)=>s.timeLeft-i.timeLeft),e}function y(){(0,n.existsSync)(p)||(0,n.writeFileSync)(p,JSON.stringify({}))}function E(e){y();let t=JSON.parse((0,n.readFileSync)(p,"utf8"));t[(0,F.randomUUID)()]=e,(0,n.writeFileSync)(p,JSON.stringify(t))}function J(){y();let e=JSON.parse((0,n.readFileSync)(p,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,s])=>s.showInMenuBar===void 0?[t,{...s,showInMenuBar:!0}]:[t,s]))}function x(e){y();let t=JSON.parse((0,n.readFileSync)(p,"utf8"));delete t[e],(0,n.writeFileSync)(p,JSON.stringify(t))}function R(e){y();let t=JSON.parse((0,n.readFileSync)(p,"utf8")),s=t[e].showInMenuBar;t[e].showInMenuBar=s===void 0?!1:!s,(0,n.writeFileSync)(p,JSON.stringify(t))}var _=()=>{if(!(0,n.existsSync)(b)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,n.writeFileSync)(b,JSON.stringify(t)),t}return JSON.parse((0,n.readFileSync)(b,"utf8"))},j=e=>{let t=JSON.parse((0,n.readFileSync)(b,"utf8"));t[e]=!t[e],(0,n.writeFileSync)(b,JSON.stringify(t))};var h=require("@raycast/api");function $(){let[e,t]=(0,P.useState)(void 0),[s,i]=(0,P.useState)({}),[r,m]=(0,P.useState)(e===void 0),c=()=>{y();let l=B();t(l);let f=J();i(f),m(!1)};return{timers:e,customTimers:s,isLoading:r,refreshTimers:c,handleStartTimer:(l,f,Y=!1)=>{V(Y)&&(O(l,f),c())},handleStopTimer:l=>{t(e?.filter(f=>f.originalFile!==l.originalFile)),v(l.originalFile),c()},handleStartCT:(l,f=!1)=>{V(f)&&(O(l.timeInSeconds,l.name,l.selectedSound),c())},handleCreateCT:l=>{let f={name:l.name,timeInSeconds:l.secondsSet,selectedSound:"default",showInMenuBar:!0};E(f),c()},handleDeleteCT:async l=>{let f={title:"Delete this preset?",icon:h.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:h.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:h.Alert.ActionStyle.Destructive}};await(0,h.confirmAlert)(f)&&(x(l),c())},handleToggleCTVisibility:async l=>{R(l),c()}}}var a=require("@raycast/api"),H=require("react");var L=require("react");function A(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,s]=(0,L.useState)(),[i,r]=(0,L.useState)(t===void 0),m=()=>{s(_()),r(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:i,refreshDefaultVisibles:m,handleDefaultPresetToggle:d=>{j(d),m()}}}var T=require("react/jsx-runtime");function U(){let{customTimers:e,isLoading:t,refreshTimers:s,handleToggleCTVisibility:i}=$(),{defaultPresets:r,defaultVisibles:m,isLoadingVisibles:c,refreshDefaultVisibles:d,handleDefaultPresetToggle:M}=A(),g={tag:{value:"Hidden",color:a.Color.Red}},S={tag:{value:"Visible",color:a.Color.Green}};return(0,H.useEffect)(()=>{s(),d()},[]),(0,T.jsxs)(a.List,{isLoading:t&&c,children:[(0,T.jsx)(a.List.Section,{title:"Custom Presets",children:Object.keys(e).sort((u,k)=>e[u].timeInSeconds-e[k].timeInSeconds).map(u=>(0,T.jsx)(a.List.Item,{title:e[u].name,subtitle:D(e[u].timeInSeconds),icon:a.Icon.Clock,accessories:[e[u].showInMenuBar?S:g],actions:(0,T.jsx)(a.ActionPanel,{children:(0,T.jsx)(a.Action,{title:e[u].showInMenuBar?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>i(u)})})},u))}),(0,T.jsx)(a.List.Section,{title:"Default Presets",children:r.map(u=>(0,T.jsx)(a.List.Item,{title:u.title,icon:a.Icon.Hourglass,accessories:[m?.[u.key]?S:g],actions:(0,T.jsx)(a.ActionPanel,{children:(0,T.jsx)(a.Action,{title:m?.[u.key]?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>M(u.key)})})},u.key))})]})}
