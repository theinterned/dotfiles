"use strict";var M=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var b=(e,t)=>{for(var o in t)M(e,o,{get:t[o],enumerable:!0})},_=(e,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of J(t))!E.call(e,r)&&r!==o&&M(e,r,{get:()=>t[r],enumerable:!(i=F(t,r))||i.enumerable});return e};var v=e=>_(M({},"__esModule",{value:!0}),e);var U={};b(U,{default:()=>N});module.exports=v(U);var n=require("@raycast/api"),w=require("react");var L=require("@raycast/api"),C=require("react");var l=require("@raycast/api"),g=require("child_process"),I=require("crypto"),a=require("fs"),k=require("path");var S=e=>{let t=Math.floor(e/3600),o=String(Math.floor(e%3600/60)).padStart(2,"0"),i=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${o}:${i}`};var d=l.environment.supportPath+"/customTimers.json";async function y(e,t="Untitled"){let i=(l.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,a.writeFileSync)(i,t);let r=(0,l.getPreferenceValues)(),T=`${l.environment.assetsPath+"/"+r.selectedSound}`,c=`sleep ${e} && if [ -f "${i}" ]; then `;if(r.selectedSound==="speak_timer_name"?c+=`say "${t}"`:c+=`afplay "${T}"`,r.ringContinuously){let s=`${i}`.replace(".timer",".dismiss");(0,a.writeFileSync)(s,".dismiss file for Timers"),c+=` && while [ -f "${s}" ]; do afplay "${T}"; done`}c+=` && osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"' && rm "${i}"; else echo "Timer deleted"; fi`,(0,g.exec)(c,(s,p)=>{if(s){console.log(`error: ${s.message}`);return}if(p){console.log(`stderr: ${p}`);return}}),(0,l.popToRoot)(),await(0,l.showHUD)(`Timer "${t}" started for ${S(e)}! \u{1F389}`)}function A(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,o=e.replace(".timer",".dismiss"),i=`if [ -f "${o}" ]; then rm "${o}"; else echo "Timer deleted"; fi`;(0,g.execSync)(t),(0,g.execSync)(i)}function P(){let e=[];return(0,a.readdirSync)(l.environment.supportPath).forEach(o=>{if((0,k.extname)(o)==".timer"){let i={name:"",secondsSet:-99,timeLeft:-99,originalFile:o};i.name=(0,a.readFileSync)(l.environment.supportPath+"/"+o).toString();let r=o.split("---");i.secondsSet=Number(r[1].split(".")[0]);let T=r[0].replace(/__/g,":");i.timeLeft=Math.max(0,Math.round(i.secondsSet-(new Date().getTime()-new Date(T).getTime())/1e3)),e.push(i)}}),e.sort((o,i)=>o.timeLeft-i.timeLeft),e}function h(){(0,a.existsSync)(d)||(0,a.writeFileSync)(d,JSON.stringify({}))}function x(e){h();let t=JSON.parse((0,a.readFileSync)(d,"utf8"));t[(0,I.randomUUID)()]=e,(0,a.writeFileSync)(d,JSON.stringify(t))}function O(){return h(),JSON.parse((0,a.readFileSync)(d,"utf8"))}function D(e){h();let t=JSON.parse((0,a.readFileSync)(d,"utf8"));delete t[e],(0,a.writeFileSync)(d,JSON.stringify(t))}function $(){let[e,t]=(0,C.useState)(void 0),[o,i]=(0,C.useState)({}),[r,T]=(0,C.useState)(e===void 0),c=()=>{h();let u=P();t(u);let f=O();i(f),T(!1)};return{timers:e,customTimers:o,isLoading:r,refreshTimers:c,handleStartTimer:(u,f)=>{y(u,f),c()},handleStopTimer:u=>{t(e?.filter(f=>f.originalFile!==u.originalFile)),A(`${L.environment.supportPath}/${u.originalFile}`),c()},handleStartCT:u=>{y(u.timeInSeconds,u.name),c()},handleCreateCT:u=>{let f={name:u.name,timeInSeconds:u.secondsSet};x(f),c()},handleDeleteCT:u=>{D(u),c()}}}var m=require("react/jsx-runtime");function N(){let{timers:e,customTimers:t,isLoading:o,refreshTimers:i,handleStartTimer:r,handleStopTimer:T,handleStartCT:c}=$();return(0,w.useEffect)(()=>{i(),setInterval(()=>{i()},1e3)},[]),(0,m.jsxs)(n.MenuBarExtra,{icon:n.Icon.Clock,isLoading:o,title:e!=null&&e?.length>0?`${e[0].name}: ~${S(e[0].timeLeft)}`:void 0,children:[(0,m.jsx)(n.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(s=>(0,m.jsx)(n.MenuBarExtra.Item,{title:s.name+": "+S(s.timeLeft)+" left",onAction:()=>T(s)},s.originalFile)),(0,m.jsx)(n.MenuBarExtra.Separator,{}),Object.keys(t)?.sort((s,p)=>t[s].timeInSeconds-t[p].timeInSeconds).map(s=>(0,m.jsx)(n.MenuBarExtra.Item,{title:'Start "'+t[s].name+'"',onAction:()=>c(t[s])},s)),(0,m.jsx)(n.MenuBarExtra.Separator,{}),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>r(60*2,"2 Minute Timer")},"2M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>r(60*5,"5 Minute Timer")},"5M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>r(60*10,"10 Minute Timer")},"10M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>r(60*15,"15 Minute Timer")},"15M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>r(60*30,"30 Minute Timer")},"30M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>r(60*45,"45 Minute Timer")},"45M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>r(60*60,"60 Minute Timer")},"60M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>r(60*60*1.5,"90 Minute Timer")},"90M"),(0,m.jsx)(n.MenuBarExtra.Section,{title:"Custom Timer",children:(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,n.launchCommand)({name:"startCustomTimer",type:n.LaunchType.UserInitiated})},"custom")})]})}0&&(module.exports={});
