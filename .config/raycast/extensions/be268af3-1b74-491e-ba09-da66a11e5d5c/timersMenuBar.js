"use strict";var $=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var j=(e,t)=>{for(var r in t)$(e,r,{get:t[r],enumerable:!0})},R=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of B(t))!U.call(e,i)&&i!==r&&$(e,i,{get:()=>t[i],enumerable:!(o=_(t,i))||o.enumerable});return e};var H=e=>R($({},"__esModule",{value:!0}),e);var V={};j(V,{default:()=>J});module.exports=H(V);var n=require("@raycast/api"),b=require("react");var N=require("@raycast/api"),M=require("react");var s=require("@raycast/api"),g=require("child_process"),O=require("crypto"),u=require("fs"),w=require("path");var h=e=>{let t=Math.floor(e/3600),r=String(Math.floor(e%3600/60)).padStart(2,"0"),o=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${r}:${o}`};var k=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var S=s.environment.supportPath+"/customTimers.json",D=(e=!1)=>{let t=(0,s.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let r="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,s.showHUD)(r):(0,s.showToast)({style:s.Toast.Style.Failure,title:r}),!1}return!0};async function I(e,t="Untitled",r="default"){let i=(s.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,u.writeFileSync)(i,t);let l=(0,s.getPreferenceValues)(),d=`${s.environment.assetsPath+"/"+(r==="default"?l.selectedSound:r)}`,f=[`sleep ${e}`];f.push(`if [ -f "${i}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let c=`afplay "${d}" --volume ${l.volumeSetting.replace(",",".")}`;if(l.selectedSound==="speak_timer_name"?f.push(`say "${t}"`):f.push(c),l.ringContinuously){let p=`${i}`.replace(".timer",".dismiss");(0,u.writeFileSync)(p,".dismiss file for Timers"),f.push(`while [ -f "${p}" ]; do ${c}; done`)}f.push(`rm "${i}"; else echo "Timer deleted"; fi`),(0,g.exec)(f.join(" && "),(p,y)=>{if(p){console.log(`error: ${p.message}`);return}if(y){console.log(`stderr: ${y}`);return}}),(0,s.popToRoot)(),await(0,s.showHUD)(`Timer "${t}" started for ${h(e)}! \u{1F389}`)}function A(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,r=e.replace(".timer",".dismiss"),o=`if [ -f "${r}" ]; then rm "${r}"; else echo "Timer deleted"; fi`;(0,g.execSync)(t),(0,g.execSync)(o)}function x(){let e=[];return(0,u.readdirSync)(s.environment.supportPath).forEach(r=>{if((0,w.extname)(r)==".timer"){let o={name:"",secondsSet:-99,timeLeft:-99,originalFile:r};o.name=(0,u.readFileSync)(s.environment.supportPath+"/"+r).toString();let i=r.split("---");o.secondsSet=Number(i[1].split(".")[0]);let l=i[0].replace(/__/g,":");o.timeLeft=Math.max(0,Math.round(o.secondsSet-k({d2:l}))),e.push(o)}}),e.sort((r,o)=>r.timeLeft-o.timeLeft),e}function C(){(0,u.existsSync)(S)||(0,u.writeFileSync)(S,JSON.stringify({}))}function L(e){C();let t=JSON.parse((0,u.readFileSync)(S,"utf8"));t[(0,O.randomUUID)()]=e,(0,u.writeFileSync)(S,JSON.stringify(t))}function F(){return C(),JSON.parse((0,u.readFileSync)(S,"utf8"))}function v(e){C();let t=JSON.parse((0,u.readFileSync)(S,"utf8"));delete t[e],(0,u.writeFileSync)(S,JSON.stringify(t))}function P(){let[e,t]=(0,M.useState)(void 0),[r,o]=(0,M.useState)({}),[i,l]=(0,M.useState)(e===void 0),d=()=>{C();let a=x();t(a);let T=F();o(T),l(!1)};return{timers:e,customTimers:r,isLoading:i,refreshTimers:d,handleStartTimer:(a,T,E=!1)=>{!D(E)||(I(a,T),d())},handleStopTimer:a=>{t(e?.filter(T=>T.originalFile!==a.originalFile)),A(`${N.environment.supportPath}/${a.originalFile}`),d()},handleStartCT:(a,T=!1)=>{!D(T)||(I(a.timeInSeconds,a.name,a.selectedSound),d())},handleCreateCT:a=>{let T={name:a.name,timeInSeconds:a.secondsSet,selectedSound:"default"};L(T),d()},handleDeleteCT:a=>{v(a),d()}}}var m=require("react/jsx-runtime");function J(){let{timers:e,customTimers:t,isLoading:r,refreshTimers:o,handleStartTimer:i,handleStopTimer:l,handleStartCT:d}=P();(0,b.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]),r&&o();let f=(0,n.getPreferenceValues)();return(e==null||e.length==0||e.length==null)&&f.showMenubarIconOnlyOnRun?null:(0,m.jsxs)(n.MenuBarExtra,{icon:n.Icon.Clock,isLoading:r,title:e!=null&&e?.length>0?`${e[0].name}: ~${h(e[0].timeLeft)}`:void 0,children:[(0,m.jsx)(n.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(c=>(0,m.jsx)(n.MenuBarExtra.Item,{title:c.name+": "+h(c.timeLeft)+" left",onAction:()=>l(c)},c.originalFile)),(0,m.jsx)(n.MenuBarExtra.Separator,{}),Object.keys(t)?.sort((c,p)=>t[c].timeInSeconds-t[p].timeInSeconds).map(c=>(0,m.jsx)(n.MenuBarExtra.Item,{title:'Start "'+t[c].name+'"',onAction:()=>d(t[c],!0)},c)),(0,m.jsx)(n.MenuBarExtra.Separator,{}),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>i(60*2,"2 Minute Timer",!0)},"2M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>i(60*5,"5 Minute Timer",!0)},"5M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>i(60*10,"10 Minute Timer",!0)},"10M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>i(60*15,"15 Minute Timer",!0)},"15M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>i(60*30,"30 Minute Timer",!0)},"30M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>i(60*45,"45 Minute Timer",!0)},"45M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>i(60*60,"60 Minute Timer",!0)},"60M"),(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>i(60*60*1.5,"90 Minute Timer",!0)},"90M"),(0,m.jsx)(n.MenuBarExtra.Section,{title:"Custom Timer",children:(0,m.jsx)(n.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,n.launchCommand)({name:"startCustomTimer",type:n.LaunchType.UserInitiated})},"custom")})]})}0&&(module.exports={});
